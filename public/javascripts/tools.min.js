var app=angular.module("prueba",[]);app.controller("controladorUno",["$scope","$http","$timeout","servicios","$window",function(e,t,a,r,n){e.people=[],e.persona={},e.newRecord={},e.currentView="infoView",e.seeMenu="mostrar",e.seePeople="mostrar",e.seeCharts="mostrar",e.newRecordTable="mostrar",e.updatePerson="mostrar",e.seeImage="mostrar",e.seeMap="mostrar",e.seeInfo="mostrar",e.position={coords:{latitude:null,longitude:null}},e.imageDetailStyle={},e.chartsLoaded=!1,e.newRecord.age=0,e.showLoader=!1,e.goMain=!1,e.occupations=[],e.maritalStatuses=[],e.order=["lastname","firstname","chileanId","birthDate","age","occupation","email","gender","address","telephone","maritalStatus","smoker"],e.gender=["m","f"],e.setearSelect=function(){e.newRecord.gender=e.gender[0];var a=new Date;a=a.toISOString(),e.newRecord.birthDate=a.substring(0,10),t.get("/clientLoader/occupations").success(function(t){angular.forEach(t,function(t){e.occupations.push(t.enVal)}),e.newRecord.occupation=e.occupations[0]}).error(function(){n.alert("Unable to load occupations. Please reload the site.")}),t.get("/clientLoader/maritalStatuses").success(function(t){angular.forEach(t,function(t){e.maritalStatuses.push(t.state)}),e.newRecord.maritalStatus=e.maritalStatuses[0]}).error(function(){n.alert("Unable to load marital statuses. Please reload the site.")})},e.setearSelect(),e.btnEnviar=!0,e.chileanIdPattern=/^([1-9]{0,1}[0-9]{1})\.[0-9]{3}\.[0-9]{3}\-[0-9kK]{1}$/,e.telephonePattern=/^\+?\d{1,3}?[- .]?\(?(?:\d{2,3})\)?[- .]?\d\d\d[- .]?\d\d\d\d$/,e.emailPattern=/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,3})$/,e.datePattern=/((([0-9][0-9][0-9][1-9])|([1-9][0-9][0-9][0-9])|([0-9][1-9][0-9][0-9])|([0-9][0-9][1-9][0-9]))-((0[13578])|(1[02]))-((0[1-9])|([12][0-9])|(3[01])))|((([0-9][0-9][0-9][1-9])|([1-9][0-9][0-9][0-9])|([0-9][1-9][0-9][0-9])|([0-9][0-9][1-9][0-9]))-((0[469])|11)-((0[1-9])|([12][0-9])|(30)))|(((000[48])|([0-9]0-9)|([0-9][1-9][02468][048])|([1-9][0-9][02468][048])|([0-9]0-9)|([0-9][1-9][13579][26])|([1-9][0-9][13579][26]))-02-((0[1-9])|([12][0-9])))|((([0-9][0-9][0-9][1-9])|([1-9][0-9][0-9][0-9])|([0-9][1-9][0-9][0-9])|([0-9][0-9][1-9][0-9]))-02-((0[1-9])|([1][0-9])|([2][0-8])))$/,e.onlyLowerCase=function(t,a){"firstname"===a?e.newRecord.firstname=e.newRecord.firstname.toLowerCase():"lastname"===a?e.newRecord.lastname=e.newRecord.lastname.toLowerCase():"occupation"===a?e.newRecord.occupation=e.newRecord.occupation.toLowerCase():"address"===a&&(e.newRecord.address=e.newRecord.address.toLowerCase())},e.calculateAge=function(e){var t=e.birthDate,a=t.split("-"),r=a[2],n=a[1],i=a[0],o=new Date,s=o.getYear(),c=o.getMonth()+1,l=o.getDate(),d=s+1900-i;n>c&&d--,n==c&&r>l&&d--,d>1900&&(d-=1900);var u=0;c>n&&(u=c-n),n>c&&(u=12-(n-c)),c==n&&r>l&&(u=11);var h=0;l>r&&(h=l-r),r>l&&(ultimoDiaMes=new Date(s,c,0),h=ultimoDiaMes.getDate()-(r-l)),d>0&&(e.age=d)},e.formatearRut=function(e){var t,a,r=e.chileanId,n=r.substring(r.length-1,r.length),o="0123456789-Kk.",s="-Kk.",c=r.split(""),l=0;for(i=0;i<c.length;i++)"-"===c[i]&&l++;var d=0;for(i=0;i<c.length;i++)("K"===c[i]||"k"===c[i])&&d++;var u=0;for(i=0;i<c.length;i++)"."===c[i]&&u++;if(r.length<=12)if(-1!==o.indexOf(n))if(1===r.length&&"0"===r.substring(0,1)&&(e.chileanId=""),-1===s.indexOf(n))3===r.length?"."!==r.substring(1,2)?(t=r.substring(0,2)+"."+r.substring(r.length-1,r.length),e.chileanId=t):e.chileanId=r:6===r.length&&"."===r.substring(1,2)?(t=r.substring(0,5)+"."+n,e.chileanId=t):7===r.length?"."===r.substring(1,2)?(t=r.substring(0,6)+n,e.chileanId=t):(t=r.substring(0,6)+"."+n,e.chileanId=t):10===r.length&&"."===r.substring(1,2)?(t=r.substring(0,9)+"-"+n,e.chileanId=t):11===r.length?0===l?(t=r.substring(0,10)+"-"+r.substring(r.length-1,r.length),e.chileanId=t):e.chileanId=e.chileanId.substring(0,e.chileanId.length):12===r.length&&("-"===n||2===l)&&(e.chileanId=e.chileanId.substring(0,e.chileanId.length-1));else if("-"===n)if(1===l)switch(r.length){case 1:e.chileanId="";break;case 10:for(a=[],i=0;i<c.length;i++)"."!==c[i]&&"-"!==c[i]&&a.push(c[i]);a=a.join(""),e.chileanId=a.substring(0,1)+"."+a.substring(1,4)+"."+a.substring(4,7)+"-";break;case 11:e.chileanId=r;break;default:e.chileanId=e.chileanId.substring(0,e.chileanId.length-1)}else e.chileanId=e.chileanId.substring(0,e.chileanId.length-1);else if("."===n)if(1===r.length&&"."===r.substring(0,1))e.chileanId="";else if(2>=u)switch(r.length){case 2:e.chileanId=r;break;case 3:"."===r.substring(1,2)&&(e.chileanId=e.chileanId.substring(0,e.chileanId.length-1));break;case 6:"."!==r.substring(1,2)&&(e.chileanId=e.chileanId.substring(0,e.chileanId.length-1));break;case 7:"."!==r.substring(2,3)&&(e.chileanId=e.chileanId.substring(0,e.chileanId.length-1));break;default:e.chileanId=e.chileanId.substring(0,e.chileanId.length-1)}else e.chileanId=e.chileanId.substring(0,e.chileanId.length-1);else if(1===l)e.chileanId=1===d?r:e.chileanId.substring(0,e.chileanId.length-1);else if(10===r.length){for(a=[],i=0;i<c.length;i++)"."!==c[i]&&"-"!==c[i]&&a.push(c[i]);a=a.join(""),e.chileanId=a.substring(0,1)+"."+a.substring(1,4)+"."+a.substring(4,7)+"-"+n}else 11===r.length?(a=r.substring(0,r.length-1),e.chileanId=a+"-"+n):e.chileanId=e.chileanId.substring(0,e.chileanId.length-1);else e.chileanId=r.substring(0,r.length-1);else t=r.substring(0,12),e.chileanId=t},e.capturaKey=function(t,r){8!==t.keyCode?a(function(){e.formatearRut(r)},10):r.chileanId=""},e.loadPeople=function(){t.get("/people/listPeople/"+e.key).success(function(r){e.people=r,angular.forEach(e.people,function(r){try{var i=r.birthDate,o=i.slice(0,10);r.birthDate=o}catch(s){n.console.log(s)}if(r.smoker=r.smoker===!0?"yes":"no",r.imageRoute){var c=r.imageRoute;a(function(){t.get("/images/downloadThumbnail/min"+c+"/"+e.key).success(function(e){r.image="data:image/jpeg;base64,"+e}).error(function(){r.image="http://icreativelabs.com/blog/wp-content/themes/icreativelabs/images/no-thumb.jpg"})},100)}})}).error(function(){n.location.href="http://"+mainUrl+"/error"})},e.appendPersona=function(r){var i={};t.get("/people/personById/"+r+"/"+e.key).success(function(r){i=r[0];var o=i.birthDate,s=o.slice(0,10);if(i.birthDate=s,i.smoker=i.smoker===!0?"yes":"no",i.imageRoute){var c=i.imageRoute;a(function(){t.get("/images/downloadThumbnail/min"+c+"/"+e.key).success(function(t){i.image="data:image/jpeg;base64,"+t;try{e.renewCharts(),e.socket.emit("nuevaPersona",i)}catch(a){n.alert(a)}}).error(function(){i.image="http://icreativelabs.com/blog/wp-content/themes/icreativelabs/images/no-thumb.jpg"})},300)}e.people.push(i)}).error(function(){n.alert("ERROR!")})},e.appendPersonaObj=function(t){try{e.people.push(t);try{e.$apply()}catch(a){n.alert("Error: "+a)}}catch(a){n.alert(a)}},e.addRecord=function(){var i=e.newRecord,o=parseInt(i.age),s=parseFloat(i.age);if(i.firstname&&i.lastname&&i.age)if(!isNaN(i.age)&&i.age>0&&i.age<110&&o==s)if(i.firstname.length>1&&i.firstname.length<20)if(i.lastname.length>1&&i.lastname.length<20)if("undefined"!=typeof i.chileanId&&e.chileanIdPattern.test(i.chileanId))if("undefined"!=typeof i.telephone)if("undefined"!=typeof i.email)if("undefined"!=typeof i.birthDate)if("undefined"!=typeof i.gender)if("undefined"!=typeof i.maritalStatus)if("undefined"==typeof i.image||"image/jpeg"!==i.image.type&&"image/jpg"!==i.image.type&&"image/png"!==i.image.type&&"image/gif"!==i.image.type)n.alert("Please add an image in some of the following formats: jpg,jpeg,png,gif");else if("undefined"!=typeof i.occupation)if(i.image.size<8e6){e.showLoader=!0;var c=i.birthDate.split("-"),l=c[0],d=c[1],u=parseInt(c[2]),h=new Date(l+"-"+d+"-"+u);i.birthDate=h;var g=i.image;i.age=parseInt(i.age);var f="/images/uploadImage/"+e.key,m=r.uploadFileToUrl(g,f);m.then(function(r){i.imageRoute=r.data,i.coordinates={},i.coordinates.latitude=e.position.coords.latitude,i.coordinates.longitude=e.position.coords.longitude,i.key=e.key,t.put("/people/addRecord/",i).success(function(){var t=i.imageRoute.substring(i.imageRoute.length-3,i.imageRoute.length);"gif"===t?a(function(){e.appendPersona(i.chileanId)},500):a(function(){e.appendPersona(i.chileanId),e.showList()},500),e.newRecord={},e.newRecord.age=0,e.setearSelect();var r=document.getElementById("imagen");r.value=r.defaultValue,e.showLoader=!1}).error(function(t){e.showLoader=!1,n.alert("Error: "+t.data+" uploading the data. Please try again.")})},function(t){e.showLoader=!1,n.alert("There was an error uploading the image. Please try again. "+t)}),delete e.newRecord.image}else n.alert("Please use images of less than 8 MB");else n.alert("Please add an occupation.");else n.alert("Please select a marital status");else n.alert("Please select a gender");else n.alert("Please enter a valid date with the following format yyyy-mm-dd");else n.alert("The email's format is incorrect. Please check and try again.");else n.alert("The phone's value is incorrect. Remember the format +countrycode/citycode/number");else n.alert("Please check and correct the id's format and try again");else n.alert("The last name has to have between 2 and 20 letters");else n.alert("The first name has to have between 2 and 20 letters");else n.alert("The age must be a number between 1 y 110");else n.alert("There is data missing or the format is not correct. Please check and try again.")},e.deleteRecord=function(a){var r=n.confirm("Are you sure you want to delete this record?");r&&(t.delete("/people/deleteRecord/"+a._id+"/"+e.key).success(function(){e.deleteRecordById(a._id),e.socket.emit("eliminarPersona",a._id)}).error(function(){n.alert("Unable to delete record. Please try again.")}),t.get("/images/deleteImageAndThumbnail/"+a.imageRoute+"/"+e.key).success(function(e){n.console.log(e)}).error(function(){n.alert("Unable to delete the images associated with the record.")}))},e.deleteRecordById=function(t){angular.forEach(e.people,function(a,r){if(angular.equals(t,a._id))try{e.people.splice(r,1),e.renewCharts();try{e.$apply()}catch(i){n.console.log("There was an error "+i)}}catch(i){n.console.log(i)}})},e.modifyRecord=function(t){e.persona=angular.copy(t),e.persona.smoker="yes"===e.persona.smoker?!0:!1,e.hideList(),e.showUpdater()},e.cancelUpdateRecord=function(){e.hideUpdater(),e.showList(),a(function(){e.persona={}},1e3)},e.updateRecord=function(){var a=e.persona,r=parseInt(a.age),i=parseFloat(a.age),o=a.image;if(a.firstname&&a.lastname&&a.age)if(!isNaN(a.age)&&a.age>0&&a.age<110&&r==i)if(a.firstname.length>1&&a.firstname.length<20)if(a.lastname.length>1&&a.lastname.length<20)if("undefined"!=typeof a.chileanId&&e.chileanIdPattern.test(a.chileanId))if("undefined"!=typeof a.telephone)if("undefined"!=typeof a.email)if("undefined"!=typeof a.occupation&&a.occupation.length>0)if("undefined"!=typeof a.birthDate&&null!==a.birthDate){var s=a.birthDate,c=a.birthDate.split("-"),l=c[0],d=c[1],u=parseInt(c[2])+1,h=new Date(l+"-"+d+"-"+u);a.birthDate=h,a.age=parseInt(a.age),a.key=e.key,"undefined"!=typeof a.gender?"undefined"!=typeof a.maritalStatus?(delete a.image,e.showLoader=!0,t.post("/people/updateRecord/",a).success(function(){e.showList(),e.hideUpdater(),a.smoker=a.smoker?"yes":"no",angular.forEach(e.people,function(t,r){angular.equals(a._id,t._id)&&(e.people[r]=a)}),a.birthDate=s,a.image=o,e.renewCharts(),e.socket.emit("actualizarPersona",a),e.showLoader=!1}).error(function(){e.showLoader=!1,n.alert(a.birthDate)})):n.alert("Please select a marital status."):n.alert("Please select a gender")}else n.alert("Please enter a valid date with the following format yyyy-mm-dd");else n.alert("Please add an occupation.");else n.alert("The email's format is incorrect. Please check and try again.");else n.alert("The phone's value is incorrect. Remember the format +countrycode/citycode/number");else n.alert("Please check and correct the id's format and try again");else n.alert("The last name has to have between 2 and 20 letters");else n.alert("The first name has to have between 2 and 20 letters");else n.alert("The age must be a number between 1 y 110");else n.alert("There is data missing or the format is not correct. Please check and try again.")},e.updateRecordObject=function(t){angular.forEach(e.people,function(a,r){if(angular.equals(t._id,a._id)){e.people[r]=t;try{e.$apply()}catch(i){n.alert("Error: "+i)}}})},e.seePicture=function(a){var n=a.imageRoute,i=(a.firstname+" "+a.lastname).capitalize();e.portrait=i,t.get("/images/downloadImage/"+n+"/"+e.key).success(function(t){e.bigImage="data:image/jpeg;base64,"+t,e.imageDetailStyle=r.resizePicture(e.bigImage.width,e.bigImage.height),e.hideList(),e.showImageDetail()}).error(function(){e.bigImage="http://icreativelabs.com/blog/wp-content/themes/icreativelabs/images/no-thumb.jpg"})},a(function(){e.loadPeople()},100),a(function(){e.seeMenu="ocultar",e.seeInfo="ocultar"},500),e.logout=function(){var a=n.confirm("Are you sure you want to log out?");a&&t.delete("/deleteKey/"+e.key).success(function(){e.key=null,n.location.href="http://"+mainUrl}).error(function(){n.alert("There was an error. Please try again.")})},e.showMenu=function(){e.seeMenu="mostrar mostrar-active",a(function(){e.seeMenu="mostrar mostrar-active reponer"},500)},e.hideMenu=function(){e.seeMenu="ocultar ocultar-active",a(function(){e.seeMenu="ocultar ocultar-active remover"},500)},e.showNewRecordForm=function(){-1!==e.currentView.indexOf("encuestas")&&e.hideList(),-1!==e.currentView.indexOf("detalleImagen")&&e.hideImageDetail(),-1!==e.currentView.indexOf("mapa")&&e.hideMap(),-1!==e.currentView.indexOf("actualizador")&&e.hideUpdater(),-1!==e.currentView.indexOf("grafico")&&e.hideCharts(),-1!==e.currentView.indexOf("infoView")&&e.hideInfo(),-1===e.currentView.indexOf("newRecordForm")&&(e.currentView="newRecordForm",e.newRecordTable="mostrar mostrar-active",a(function(){e.newRecordTable="mostrar mostrar-active reponer",n.scrollTo(0,0)},500))},e.hideNewRecordForm=function(){e.newRecordTable="ocultar ocultar-active",a(function(){e.newRecordTable="ocultar ocultar-active remover"},500)},e.showList=function(){-1!==e.currentView.indexOf("detalleImagen")&&e.hideImageDetail(),-1!==e.currentView.indexOf("mapa")&&e.hideMap(),-1!==e.currentView.indexOf("actualizador")&&e.hideUpdater(),-1!==e.currentView.indexOf("newRecordForm")&&e.hideNewRecordForm(),-1!==e.currentView.indexOf("grafico")&&e.hideCharts(),-1!==e.currentView.indexOf("infoView")&&e.hideInfo(),-1===e.currentView.indexOf("encuestas")&&(e.currentView="encuestas",e.seePeople="mostrar mostrar-active",a(function(){e.seePeople="mostrar mostrar-active reponer",n.scrollTo(0,0)},500))},e.hideList=function(){e.seePeople="ocultar ocultar-active",a(function(){e.seePeople="ocultar ocultar-active remover"},500)},e.showUpdater=function(){-1!==e.currentView.indexOf("encuestas")&&e.hideList(),-1!==e.currentView.indexOf("detalleImagen")&&e.hideImageDetail(),-1!==e.currentView.indexOf("mapa")&&e.hideMap(),-1!==e.currentView.indexOf("newRecordForm")&&e.hideNewRecordForm(),-1!==e.currentView.indexOf("grafico")&&e.hideCharts(),-1!==e.currentView.indexOf("infoView")&&e.hideInfo(),-1===e.currentView.indexOf("actualizador")&&(e.currentView="actualizador",e.updatePerson="mostrar mostrar-active",a(function(){e.updatePerson="mostrar mostrar-active reponer"},500))},e.hideUpdater=function(){e.updatePerson="ocultar ocultar-active",a(function(){e.updatePerson="ocultar ocultar-active remover"},500)},e.showImageDetail=function(){-1!==e.currentView.indexOf("encuestas")&&e.hideList(),-1!==e.currentView.indexOf("mapa")&&e.hideMap(),-1!==e.currentView.indexOf("actualizador")&&e.hideUpdater(),-1!==e.currentView.indexOf("newRecordForm")&&e.hideNewRecordForm(),-1!==e.currentView.indexOf("grafico")&&e.hideCharts(),-1!==e.currentView.indexOf("infoView")&&e.hideInfo(),-1===e.currentView.indexOf("detalleImagen")&&(e.currentView="detalleImagen",e.seeImage="mostrar mostrar-active",a(function(){e.seeImage="mostrar mostrar-active reponer",n.scrollTo(0,0)},500))},e.hideImageDetail=function(){e.seeImage="ocultar ocultar-active",a(function(){e.seeImage="ocultar ocultar-active remover"},500)},e.showMap=function(t){-1!==e.currentView.indexOf("encuestas")&&e.hideList(),-1!==e.currentView.indexOf("detalleImagen")&&e.hideImageDetail(),-1!==e.currentView.indexOf("actualizador")&&e.hideUpdater(),-1!==e.currentView.indexOf("newRecordForm")&&e.hideNewRecordForm(),-1!==e.currentView.indexOf("grafico")&&e.hideCharts(),-1!==e.currentView.indexOf("infoView")&&e.hideInfo(),-1===e.currentView.indexOf("mapa")&&(e.currentView="mapa",e.seeMap="mostrar mostrar-active",a(function(){e.seeMap="mostrar mostrar-active reponer",e.loadMap(t)},800))},e.hideMap=function(){e.seeMap="ocultar ocultar-active",a(function(){e.seeMap="ocultar ocultar-active remover"},500)},e.showInfo=function(){-1!==e.currentView.indexOf("encuestas")&&e.hideList(),-1!==e.currentView.indexOf("detalleImagen")&&e.hideImageDetail(),-1!==e.currentView.indexOf("actualizador")&&e.hideUpdater(),-1!==e.currentView.indexOf("newRecordForm")&&e.hideNewRecordForm(),-1!==e.currentView.indexOf("grafico")&&e.hideCharts(),-1===e.currentView.indexOf("infoView")&&(e.currentView="infoView",e.seeInfo="mostrar mostrar-active",a(function(){e.seeInfo="mostrar mostrar-active reponer",e.goMain=!1},500))},e.hideInfo=function(){e.seeInfo="ocultar ocultar-active",a(function(){e.seeInfo="ocultar ocultar-active remover",e.goMain=!0},500)},e.renewCharts=function(){e.chartsLoaded=!1,"grafico"===e.currentView&&(e.currentView="",e.showCharts())},e.showCharts=function(){-1!==e.currentView.indexOf("encuestas")&&e.hideList(),-1!==e.currentView.indexOf("detalleImagen")&&e.hideImageDetail(),-1!==e.currentView.indexOf("mapa")&&e.hideMap(),-1!==e.currentView.indexOf("actualizador")&&e.hideUpdater(),-1!==e.currentView.indexOf("newRecordForm")&&e.hideNewRecordForm(),-1!==e.currentView.indexOf("infoView")&&e.hideInfo(),-1===e.currentView.indexOf("grafico")&&(e.currentView="grafico",e.seeCharts="mostrar mostrar-active",a(function(){e.seeCharts="mostrar mostrar-active reponer",n.scrollTo(0,0),e.prepareCharts()},500))},e.hideCharts=function(){e.seeCharts="ocultar ocultar-active",a(function(){e.seeCharts="ocultar ocultar-active remover"},500)},e.prepareCharts=function(){e.chartsLoaded||(e.showLoader=!0,e.drawDiv("graficoUno","-7%"),e.loadCharts(1),e.drawDiv("graficoDos","10%"),e.loadCharts(2),e.drawDiv("graficoTres","10%"),e.loadCharts(3),e.chartsLoaded=!0)},e.drawDiv=function(e,t){var a=document.getElementById(e);a.style.width="80%",a.style.height="700px",a.style.position="inherit",a.style.marginTop=t,a.style.marginLeft="20%",a.style.backgroundColor="#CFF9D9",a.style.border="2px solid black"},e.loadCharts=function(t){google.load("visualization","1",{packages:["corechart"],callback:function(){e.drawCharts(t)}})},e.drawCharts=function(a){switch(a){case 1:t.get("/querys/smokersVsNonsmokers/"+e.key).success(function(e){var t=parseInt(e.smokers),a=parseInt(e.nonSmokers);if(0===t&&0===a){var r=document.getElementById("graficoUno");r.innerHTML="<h1>There's no data to draw the chart. Please fill in a form.</h1>"}else{var n=google.visualization.arrayToDataTable([["Marca","Votos"],["Smokers",t],["Non-smokers",a],["otros",0]]),i={title:"Smokers vs Non-smokers",is3D:!0,backgroundColor:"transparent"},o=new google.visualization.PieChart(document.getElementById("graficoUno"));o.draw(n,i)}}).error(function(){n.alert("There was an error in the connection. Please reload the page")});break;case 2:t.get("/querys/smokersByGender/"+e.key).success(function(e){var t=parseInt(e.men),a=parseInt(e.women);if(0===t&&0===a){var r=document.getElementById("graficoDos");r.innerHTML="<h1>There's no data to draw the chart. Please fill in a form.</h1>"}else{var n=google.visualization.arrayToDataTable([["Marca","Votos"],["Men",t],["Women",a],["otros",0]]),i={title:"Smokers by gender",is3D:!0,backgroundColor:"transparent"},o=new google.visualization.PieChart(document.getElementById("graficoDos"));o.draw(n,i)}}).error(function(){n.alert("There was an error in the connection. Please reload the page")});break;case 3:t.get("/querys/smokersByAgeRange/"+e.key).success(function(e){var t=parseInt(e.firstRange),a=parseInt(e.secondRange),r=parseInt(e.thirdRange),n=parseInt(e.fourthRange),i=parseInt(e.fifthRange);if(0===t&&0===a&&0===r&&0===n&&0===i){var o=document.getElementById("graficoTres");o.innerHTML="<h1>There's no data to draw the chart. Please fill in a form.</h1>"}else{var s=google.visualization.arrayToDataTable([["Marca","Votos"],["11-20 years",t],["21-30 years",a],["31-40 years",r],["41-50 years",n],["51-60 years",i],["otros",0]]),c={title:"Smokers by age range",is3D:!0,backgroundColor:"transparent"},l=new google.visualization.PieChart(document.getElementById("graficoTres"));l.draw(s,c)}}).error(function(){n.alert("There was an error")}),e.showLoader=!1}},e.geolocate=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){e.$apply(function(){e.position=t})})},e.geolocate(),e.loadMap=function(t){a(function(){var r=document.getElementById("mapa");if(t.hasOwnProperty("coordinates"))if(null!==t.coordinates.latitude&&"undefined"!==t.coordinates.latitude&&null!==t.coordinates.longitude&&"undefined"!==t.coordinates.longitude){var n=new google.maps.LatLng(t.coordinates.latitude,t.coordinates.longitude),i={zoom:14,center:n},o=new google.maps.Map(r,i),s=new google.maps.LatLng(t.coordinates.latitude,t.coordinates.longitude),c=new google.maps.Marker({position:s,map:o,title:"Geolocation",url:"http://"+mainUrl});google.maps.event.addListener(c,"click",function(){window.open(c.url)})}else r.innerHTML="<br><h3>Sorry, there  are no coordinates registered for this record!!</h3>",a(function(){e.showList()},1e3);else r.innerHTML="<br><h3>Sorry, there  are no coordinates registered for this record!!</h3>",a(function(){e.showList()},1e3)},100)},e.workInProgress=function(){n.alert("We are currently working on this section. It will be ready soon...")},e.socket=r.socket(),e.socket.on("pruebaRefresh",function(){}),e.socket.on("update",function(){e.loadPeople(),e.renewCharts()}),e.socket.on("newAppend",function(t){e.appendPersonaObj(t),e.renewCharts()}),e.socket.on("deletePerson",function(t){e.deleteRecordById(t),e.renewCharts()}),e.socket.on("updatePerson",function(t){e.updateRecordObject(t),e.renewCharts()})}]).directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,a,r){var n=e(r.fileModel),i=n.assign;a.bind("change",function(){t.$apply(function(){i(t,a[0].files[0])})})}}}]).factory("servicios",["$http",function(e){return{value:null,uploadFileToUrl:function(t,a){var r=new FormData;r.append("file",t);var n=e.post(a,r,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(e){return e}).error(function(e){return $window.alert(e),e});return n},resizePicture:function(e,t){var a={};a.borderRadius="5px 5px 5px 5px";var r,n=e,i=t,o=400;return r=parseInt(i*o/n),a.height=r+"px",a.width=o+"px",a},socket:function(){var e=io.connect("http://"+mainUrl);return e}}}]);